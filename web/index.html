<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Fruit Keyboard🍓</title>
        <style>
    body {
        font-family: sans-serif;
        text-align: center;
        background-color: #fefe70;
        padding: 2rem;
        background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 400" preserveAspectRatio="xMidYMid slice"><defs><pattern id="fruitPattern" patternUnits="userSpaceOnUse" width="120" height="240"><text x="0"   y="0"   font-size="14">🍎</text><text x="40"  y="0"   font-size="14">🍎</text><text x="80"  y="0"   font-size="14">🍎</text><text x="20"  y="40"  font-size="14">🎵</text><text x="60"  y="40"  font-size="14">🎵</text><text x="100" y="40"  font-size="14">🎵</text><text x="0"   y="80"  font-size="14">🍌</text><text x="40"  y="80"  font-size="14">🍌</text><text x="80"  y="80"  font-size="14">🍌</text><text x="20"  y="120" font-size="14">🎹</text><text x="60"  y="120" font-size="14">🎹</text><text x="100" y="120" font-size="14">🎹</text><text x="0"   y="160" font-size="14">🍊</text><text x="40"  y="160" font-size="14">🍊</text><text x="80"  y="160" font-size="14">🍊</text><text x="20"  y="200" font-size="14">🎶</text><text x="60"  y="200" font-size="14">🎶</text><text x="100" y="200" font-size="14">🎶</text><text x="0"   y="240" font-size="14">🍎</text><text x="40"  y="240" font-size="14">🍎</text><text x="80"  y="240" font-size="14">🍎</text></pattern></defs><rect width="100%" height="100%" fill="url(%23fruitPattern)"/></svg>');
        background-repeat: repeat;
        background-size: 100%;
    }
    h1 {
        font-size: 2.5rem;
    }
    h2 {
        font-weight: normal;
        font-size: 1.5rem;
    }
    button {
        font-size: 1rem;
        padding: 0.5rem 1.2rem;
        width: 100%;
        cursor: pointer;
        border: 2px solid #ccc;
        border-radius: 10px;
        background: white;
        transition: background 0.2s ease;
    }
    button:hover {
        background: #f0f0f0;
    }
    select {
        font-size: 1rem;
        padding: 0.5rem 1.2rem;
        cursor: pointer;
        border: 2px solid #ccc;
        border-radius: 10px;
        background: white;
        transition: background 0.2s ease;
    }
    #menu-screen {
        display: block;
    }
    #game-screen {
        display: none;
    }
    #listen-screen {
        display: none;
    }
    #play-screen {
        display: none;
    }
    #freeplay-screen {
        display: none;
    }
    .screen {
        margin: 2rem;
    }
    .menu-item {
        display: flex;
        align-items: center;
        justify-content: center; /* optional: center in parent */
        margin: 1rem;
        gap: 0.5rem; /* optional: space between label and select */
        width: auto;
    }
    .menu-label {
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s ease;
        width: 30%;
    }
    .menu-select {
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.2s ease;
        width: 70%;
    }
    .fruit-display {
        font-size: 12rem;
        margin-top: 2.5rem;
        transition: transform 0.2s ease;
    }
    .fruit-name {
        font-size: 2rem;
        margin-top: 0.5rem;
        color: #444;
    }
    .song-result {
        font-size: 1rem;
        margin-top: 0.5rem;
        color: #444;
    }
    .song-sequence {
        font-size: 3rem;
        margin-top: 2.5rem;
        transition: transform 0.2s ease;
    }
    .content {
        border: 2px solid #ccc;
        border-radius: 10px;
        background-color: #ffffffee;
        background-opa
        margin-top: 0;
        margin-bottom: 0;
        margin-left: auto;
        margin-right: auto;
        padding-top: 2rem;
        padding-bottom: 2rem;
        width: 100%;
        max-width: 500px;
    }
        </style>
    </head>
    <body>

        <div id="content-div" class="content">

            <h1>Fruit Tones</h1>

            <div id="menu-screen" class="screen">

                <h2>
                    Menu
                </h2>

                <div class="menu-item">
                    <label class="menu-label" for="song-select">Song:</label><br>
                    <select id="song-select" class="menu-select">
                    </select>
                </div>

                <div class="menu-item">
                    <button onclick="listenToSong()">Listen to Song</button>
                </div>

                <div class="menu-item">
                    <button onclick="playSong()">Play Song</button>
                </div>

                <div class="menu-item">
                    <button onclick="freeplay()">Freeplay</button>
                </div>

            </div>

            <div id="listen-screen" class="screen">

                <h2>
                    Listening to song: <strong id="listen-song"></strong>
                </h2>

                <div id="listen-sequence" class="song-sequence"></div>


                <div class="menu-item">
                    <button onclick="returnToMenu()">Return to Menu</button>
                </div>

            </div>

            <div id="play-screen" class="screen">

                <h2>
                    Playing song: <strong id="play-song"></strong>
                </h2>

                <div id="play-result" class="song-result"></div>

                <div class="menu-item">
                    <button onclick="returnToMenu()">Return to Menu</button>
                </div>

            </div>

            <div id="freeplay-screen" class="screen">

                <h2>Freeplay</h2>

                <div class="menu-item">
                    <button onclick="returnToMenu()">Return to Menu</button>
                </div>

            </div>

        </div>

        <script>

            function listenToSong() {
                const selectedSong = document.getElementById('song-select').value;

                fetch('/setsong', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ song: parseInt(selectedSong) })
                }).catch(err => console.error("Failed to set song:", err));


                fetch('/listen')
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("listen-song").textContent = data.name;
                        document.getElementById("listen-sequence").textContent = data.sequence;
                    })
                    .then(() => {
                        document.getElementById('menu-screen').style.display = 'none';
                        document.getElementById('listen-screen').style.display = 'block';
                    })
                    .catch(err => console.error("Failed to start game:", err));
            }

            function playSong() {
                const selectedSong = document.getElementById('song-select').value;

                fetch('/setsong', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ song: parseInt(selectedSong) })
                }).catch(err => console.error("Failed to set song:", err));


                fetch('/play')
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("play-song").textContent = data.name;
                    })
                    .then(() => {
                        document.getElementById('menu-screen').style.display = 'none';
                        document.getElementById('play-screen').style.display = 'block';
                    })
                    .catch(err => console.error("Failed to start game:", err));
            }

            function freeplay() {

                fetch('/freeplay', { method: 'POST' })
                    .then(() => {
                        document.getElementById('menu-screen').style.display = 'none';
                        document.getElementById('freeplay-screen').style.display = 'block';
                    })
                    .catch(err => console.error("Failed to start game:", err));
            }

            function returnToMenu() {

                fetch('/return', { method: 'POST' })
                    .then(() => {
                        document.getElementById('play-screen').style.display = 'none';
                        document.getElementById('freeplay-screen').style.display = 'none';
                        document.getElementById('listen-screen').style.display = 'none';
                        document.getElementById('menu-screen').style.display = 'block';
                    })
                    .catch(err => console.error("Failed to start game:", err));
            }

            function populateSongSelect() {
                fetch('/song-list')
                    .then(res => res.json())
                    .then(songs => {
                        const select = document.getElementById('song-select');
                        select.innerHTML = ""; // Clear existing options
                        songs.forEach((song, index) => {
                            const option = document.createElement("option");
                            option.value = index;
                            option.textContent = song;
                            select.appendChild(option);
                        });
                    })
                    .catch(err => console.error("Failed to load songs:", err));
            }

            // Call this when the page loads
            window.onload = populateSongSelect;

            function updateStatus() {
                fetch('/status')
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("play-result").textContent = data.result;
                    })
                    .catch(err => console.error("Failed to fetch /status:", err));
            }

            setInterval(updateStatus, 100); // poll every 100 ms instead of 10ms to be lighter
        </script>

    </body>
</html>
